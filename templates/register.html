<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Registro ‚Äî BubuGame</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#0f172a">
  <style>
    :root{
      --bg: radial-gradient(circle at 30% -10%, #0f172a 0%, #0b1228 40%, #020617 70%, #000 100%);
      --card: rgba(15,23,42,.45);
      --stroke: rgba(148,163,184,.28);
      --ink: #e2e8f0;
      --muted: #94a3b8;
      --accent: #f472b6;
      --accent-2: #fb7185;
      --ok: #22c55e;
      --warn: #f59e0b;
      --bad: #ef4444;
      --radius: 18px;
      --shadow: 0 18px 50px rgba(244,114,182,.18);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--ink);
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    /* glows */
    .glow, .glow2{
      position: fixed;
      inset: -20% -20% auto auto;
      width: 60vmax; height: 60vmax;
      background: radial-gradient(circle, rgba(244,114,182,.12), transparent 60%);
      filter: blur(60px);
      z-index: 0;
      animation: drift 18s ease-in-out infinite alternate;
      pointer-events: none;
    }
    .glow2{
      inset: auto auto -25% -25%;
      width: 50vmax; height: 50vmax;
      background: radial-gradient(circle, rgba(56,189,248,.09), transparent 60%);
      animation-duration: 22s;
    }
    @keyframes drift {
      from { transform: translate3d(-2%, 0, 0) scale(1); }
      to   { transform: translate3d(2%, -2%, 0) scale(1.05); }
    }

    .wrap{
      position: relative;
      z-index: 1;
      width: min(420px, 92vw);
      padding: 24px;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      padding: 20px 20px 18px;
    }

    .brand{
      display: flex; align-items: center; gap: .75rem;
      margin-bottom: .75rem;
    }
    .brand-logo{
      width: 40px; height: 40px; border-radius: 10px;
      background: rgba(2,6,23,.6);
      border: 1px solid rgba(148,163,184,.25);
      display: grid; place-items: center;
      overflow: hidden;
    }
    .brand-logo img{ width: 100%; height: 100%; object-fit: cover; }
    .brand h1{ margin: 0; font-size: 1.15rem; font-weight: 800; }
    .brand p{ margin: 0; font-size: .8rem; color: var(--muted); }

    .err{
      background: rgba(248,113,113,.12);
      border: 1px solid rgba(248,113,113,.35);
      color: #fecaca;
      padding: .55rem .7rem;
      border-radius: 12px;
      margin: .75rem 0 .5rem;
      animation: shake .25s ease-in-out;
    }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    form { margin-top: .5rem; display: grid; gap: .65rem; }

    .field{ display: grid; gap: .35rem; }
    .label{ font-size: .8rem; color: var(--muted); }
    .hint{ font-size: .75rem; color: var(--muted); }

    .control{ position: relative; }
    input{
      width: 100%;
      background: rgba(2,6,23,.45);
      border: 1px solid rgba(148,163,184,.25);
      color: var(--ink);
      border-radius: 14px;
      padding: .7rem .85rem;
      font: inherit;
      outline: none;
      transition: border-color .15s ease, background .15s ease, box-shadow .15s ease;
    }
    input::placeholder{ color: rgba(226,232,240,.45); }
    input:focus{
      border-color: rgba(244,114,182,.6);
      box-shadow: 0 0 0 3px rgba(244,114,182,.18);
      background: rgba(2,6,23,.6);
    }

    .toggle-pass{
      position: absolute; right: 10px; top: 50%;
      transform: translateY(-50%);
      background: transparent; border: 0; color: var(--muted);
      cursor: pointer; padding: 4px; border-radius: 8px;
    }
    .toggle-pass:hover{ color: var(--ink); background: rgba(148,163,184,.12); }

    /* strength meter */
    .meter{
      height: 8px; border-radius: 999px;
      background: rgba(148,163,184,.18);
      overflow: hidden; position: relative;
    }
    .meter > span{
      position: absolute; inset: 0 100% 0 0;
      background: linear-gradient(90deg, var(--bad), var(--warn), var(--ok));
      transition: inset .25s ease;
    }
    .meter-label{
      font-size: .75rem; color: var(--muted);
      display: flex; justify-content: space-between;
    }

    .row{
      display: flex; align-items: center; justify-content: space-between;
      gap: .75rem; margin-top: .2rem;
    }
    .terms{
      display: inline-flex; align-items: center; gap: .45rem;
      color: var(--muted); font-size: .85rem;
    }
    .terms input[type="checkbox"]{ width: 16px; height: 16px; border-radius: 4px; accent-color: var(--accent); }

    .btn{
      appearance: none;
      display: inline-flex; align-items: center; justify-content: center;
      gap: .5rem;
      width: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: white;
      border: none; border-radius: 12px;
      padding: .7rem 1rem; font-weight: 800;
      margin-top: .2rem;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(244,114,182,.25);
      transition: transform .08s ease, filter .2s ease;
    }
    .btn:hover{ filter: brightness(1.05); }
    .btn:active{ transform: translateY(1px); }
    .btn[disabled]{ opacity: .6; cursor: not-allowed; }

    .links{
      margin-top: .75rem; text-align: center; font-size: .9rem; color: var(--muted);
    }
    .links a{ color: var(--accent); text-decoration: none; font-weight: 700; }
    .links a:hover{ text-decoration: underline; }

    @media (max-width: 420px){
      .wrap{ padding: 16px; }
      .card{ padding: 18px 16px 14px; }
    }
    @media (prefers-reduced-motion: reduce) {
      .glow, .glow2 { animation: none; }
      .btn, input { transition: none; }
    }
  </style>
</head>
<body>
  <div class="glow"></div>
  <div class="glow2"></div>

  <div class="wrap">
    <div class="card">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true">
          <img src="{{ url_for('static', filename='logo.png') }}" alt="">
        </div>
        <div>
          <h1>Crear cuenta</h1>
          <p>√önete a BubuGame üíñ</p>
        </div>
      </div>

      {% if error %}
        <div class="err" role="alert">{{ error }}</div>
      {% endif %}

      <form method="post" id="regForm" novalidate>
        <div class="field">
          <label for="username" class="label">Usuario</label>
          <div class="control">
            <input id="username" name="username" placeholder="Tu usuario" autocomplete="username" required>
          </div>
        </div>

        <div class="field">
          <label for="email" class="label">Correo <span class="hint">(opcional)</span></label>
          <div class="control">
            <input id="email" name="email" type="email" placeholder="tucorreo@ejemplo.com" autocomplete="email">
          </div>
        </div>

        <div class="field">
          <label for="password" class="label">Contrase√±a</label>
          <div class="control">
            <input id="password" name="password" type="password" placeholder="M√≠nimo 6 caracteres" autocomplete="new-password" required>
            <button class="toggle-pass" type="button" aria-label="Mostrar u ocultar contrase√±a" data-target="password">üëÅÔ∏è</button>
          </div>
          <div class="meter" aria-hidden="true"><span id="meterFill"></span></div>
          <div class="meter-label" id="meterLabel">
            <span>Fuerza:</span><strong>‚Äî</strong>
          </div>
        </div>

        <div class="field">
          <label for="confirm" class="label">Confirmar contrase√±a</label>
          <div class="control">
            <input id="confirm" name="confirm" type="password" placeholder="Repite tu contrase√±a" autocomplete="new-password" required>
            <button class="toggle-pass" type="button" aria-label="Mostrar u ocultar contrase√±a" data-target="confirm">üëÅÔ∏è</button>
          </div>
          <span class="hint" id="matchHint">Debe coincidir con la contrase√±a.</span>
        </div>

        <label class="terms">
          <input type="checkbox" id="terms" required>
          Acepto los t√©rminos y la pol√≠tica de privacidad.
        </label>

        <button class="btn" type="submit" id="submitBtn" disabled>
          <span>Registrar</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 12h14M13 5l7 7-7 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>

      <div class="links">
        ¬øYa tienes cuenta?
        <a href="{{ url_for('login') }}">Iniciar sesi√≥n</a>
      </div>
    </div>
  </div>

  <script>
    // ==== Helpers ====
    const $ = (sel) => document.querySelector(sel);
    const form = $('#regForm');
    const submitBtn = $('#submitBtn');
    const user = $('#username');
    const email = $('#email');
    const pwd = $('#password');
    const confirmPwd = $('#confirm');
    const terms = $('#terms');
    const meterFill = $('#meterFill');
    const meterLabel = $('#meterLabel')?.querySelector('strong');
    const matchHint = $('#matchHint');

    // Toggle show/hide
    document.querySelectorAll('.toggle-pass').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const target = document.getElementById(btn.dataset.target);
        const isPwd = target.type === 'password';
        target.type = isPwd ? 'text' : 'password';
        btn.textContent = isPwd ? 'üôà' : 'üëÅÔ∏è';
      });
    });

    // Password strength (simple score)
    function strengthScore(v){
      let s = 0;
      if (v.length >= 6) s++;
      if (v.length >= 10) s++;
      if (/[A-Z]/.test(v)) s++;
      if (/[0-9]/.test(v)) s++;
      if (/[^A-Za-z0-9]/.test(v)) s++;
      return Math.min(s, 5);
    }
    function updateMeter(){
      const v = pwd.value.trim();
      const s = strengthScore(v);
      const perc = (s/5)*100;
      meterFill.style.insetInlineEnd = (100 - perc) + '%';
      const labels = ['Muy d√©bil','D√©bil','Media','Buena','Fuerte'];
      meterLabel.textContent = s ? labels[s-1] : '‚Äî';
    }

    // Match confirm
    function passwordsMatch(){
      const ok = !!pwd.value && (pwd.value === confirmPwd.value);
      matchHint.style.color = ok ? 'var(--ok)' : 'var(--muted)';
      matchHint.textContent = ok ? '¬°Coinciden!' : 'Debe coincidir con la contrase√±a.';
      return ok;
    }

    // Email basic validity (optional)
    function validEmail(){
      if (!email.value) return true;
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value);
    }

    // Enable/disable submit
    function updateSubmitState(){
      const ok = user.value.trim().length > 0
        && pwd.value.trim().length >= 6
        && passwordsMatch()
        && terms.checked
        && validEmail();
      submitBtn.disabled = !ok;
    }

    // Listeners
    ['input','change'].forEach(evt=>{
      [user, email, pwd, confirmPwd, terms].forEach(el=>{
        el.addEventListener(evt, ()=>{
          if (el === pwd) updateMeter();
          if (el === pwd || el === confirmPwd) passwordsMatch();
          updateSubmitState();
        });
      });
    });

    // Init
    updateMeter();
    updateSubmitState();
    user && !user.value && user.focus();

    // UX: deshabilitar al enviar
    form?.addEventListener('submit', ()=>{
      submitBtn.disabled = true;
      submitBtn.style.filter = 'grayscale(.2)';
    });
  </script>
</body>
</html>
